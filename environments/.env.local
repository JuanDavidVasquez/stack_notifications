# ========================================
# CONFIGURACIÓN DE LA APLICACIÓN
# ========================================
APP_NAME=OLPD - Notifications Service
APP_DESCRIPTION=Microservicio de envío de notificaciones (Email, Push, SMS)
APP_VERSION=1.0.0
NODE_ENV=development
PORT=5000
APP_BASE_URL=http://localhost:5000

# APIs que consumirán este servicio
MAIN_API_URL=http://localhost:4000
WEBSOCKET_API_URL=http://localhost:5001
CRON_API_URL=http://localhost:5002

# ========================================
# CONFIGURACIÓN DE REDIS (COLA DE MENSAJES)
# ========================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=notif:

# Configuración de conexión
REDIS_MAX_RETRIES=5
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000
REDIS_ENABLE_OFFLINE_QUEUE=true

# Colas de procesamiento por tipo
REDIS_QUEUE_EMAIL=queue:email
REDIS_QUEUE_PUSH=queue:push
REDIS_QUEUE_SMS=queue:sms

# Colas por prioridad
REDIS_QUEUE_URGENT=queue:priority:urgent
REDIS_QUEUE_HIGH=queue:priority:high
REDIS_QUEUE_NORMAL=queue:priority:normal
REDIS_QUEUE_LOW=queue:priority:low

# TTL para datos temporales
REDIS_TTL_PROCESSING=300           # 5 minutos (notificaciones en proceso)
REDIS_TTL_FAILED=86400            # 24 horas (notificaciones fallidas)
REDIS_TTL_SENT=3600               # 1 hora (confirmaciones de envío)
REDIS_TTL_RATE_LIMIT=3600         # 1 hora (rate limiting)

# Rate Limiting
REDIS_RATE_LIMIT_EMAIL_PER_USER=50      # Por hora
REDIS_RATE_LIMIT_SMS_PER_USER=20        # Por hora
REDIS_RATE_LIMIT_PUSH_PER_USER=100      # Por hora
REDIS_RATE_LIMIT_GLOBAL=10000           # Por hora (todas las notificaciones)

# ========================================
# AUTENTICACIÓN ENTRE SERVICIOS
# ========================================
# Token compartido para validar requests entre microservicios
SERVICE_AUTH_TOKEN=_+Nw>*4[%!%MfY-{egjXa1t^h+C&fR,I4$vUZ*A4*M:B;bk6

# JWT para validar usuarios (compartido con API principal)
JWT_AUTH_SECRET=7:f|)Be{yCto&{MHvl{YdboFRNRfu&7^ZsUU9B!MCG4(Z($_fSmfX_!YB+:yQf39
JWT_ALGORITHM=RS256
JWT_USE_ASYMMETRIC=true
JWT_CERTS_PATH=./certs

# ========================================
# CONFIGURACIÓN DE EMAIL (SMTP)
# ========================================
EMAIL_ENABLED=true
EMAIL_PROVIDER=smtp  # smtp | sendgrid | ses | mailgun

# SMTP Configuration
SMTP_HOST=sandbox.smtp.mailtrap.io
SMTP_PORT=2525
SMTP_USER=3b944c4cf8d08a
SMTP_PASS=727837fc2dbd9d
SMTP_FROM_EMAIL=no-reply@onelessonperday.com
SMTP_FROM_NAME=One Lesson Per Day
SMTP_SECURE=false

# SendGrid (alternativa)
# EMAIL_PROVIDER=sendgrid
# SENDGRID_API_KEY=your-sendgrid-api-key

# Amazon SES (alternativa)
# EMAIL_PROVIDER=ses
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key
# AWS_REGION=us-east-1

# Configuración de templates
EMAIL_TEMPLATE_DIR=./templates/email
EMAIL_DEFAULT_LANGUAGE=es
EMAIL_SUPPORTED_LANGUAGES=es,en

# Límites y reintentos
EMAIL_MAX_RETRIES=3
EMAIL_RETRY_DELAY=5000              # 5 segundos
EMAIL_BATCH_SIZE=50                 # Envíos simultáneos
EMAIL_TIMEOUT=30000                 # 30 segundos

# ========================================
# NOTIFICACIONES PUSH
# ========================================
PUSH_ENABLED=true

# Firebase Cloud Messaging (Android/Web)
FCM_ENABLED=true
FCM_SERVICE_ACCOUNT_PATH=./config/firebase-service-account.json
# FCM_PROJECT_ID=your-project-id
# FCM_SENDER_ID=your-sender-id

# Apple Push Notification Service (iOS)
APNS_ENABLED=false
# APNS_KEY_PATH=./config/apns-key.p8
# APNS_KEY_ID=your-key-id
# APNS_TEAM_ID=your-team-id
# APNS_BUNDLE_ID=com.onelessonperday.app
# APNS_PRODUCTION=false

# Web Push API (PWA)
WEB_PUSH_ENABLED=true
# WEB_PUSH_VAPID_PUBLIC_KEY=your-public-key
# WEB_PUSH_VAPID_PRIVATE_KEY=your-private-key
WEB_PUSH_VAPID_EMAIL=mailto:admin@onelessonperday.com

# Límites y reintentos Push
PUSH_MAX_RETRIES=3
PUSH_RETRY_DELAY=5000
PUSH_BATCH_SIZE=100
PUSH_TIMEOUT=10000

# ========================================
# SMS (Twilio como principal)
# ========================================
SMS_ENABLED=false
SMS_PROVIDER=twilio  # twilio | aws-sns | messagebird

# Twilio Configuration
# TWILIO_ACCOUNT_SID=your-account-sid
# TWILIO_AUTH_TOKEN=your-auth-token
# TWILIO_FROM_NUMBER=+1234567890
# TWILIO_MESSAGING_SERVICE_SID=your-messaging-service-sid

# AWS SNS (alternativa)
# SMS_PROVIDER=aws-sns
# AWS_SNS_ACCESS_KEY_ID=your-access-key
# AWS_SNS_SECRET_ACCESS_KEY=your-secret-key
# AWS_SNS_REGION=us-east-1

# Límites y reintentos SMS
SMS_MAX_RETRIES=2
SMS_RETRY_DELAY=10000              # 10 segundos
SMS_MAX_LENGTH=160                 # Caracteres
SMS_TIMEOUT=15000                  # 15 segundos

# ========================================
# PROCESAMIENTO DE COLAS
# ========================================
# Configuración del worker que procesa las colas
QUEUE_CONCURRENT_JOBS=10           # Jobs simultáneos
QUEUE_POLL_INTERVAL=1000           # Intervalo de polling en ms
QUEUE_VISIBILITY_TIMEOUT=60000     # Timeout para procesar un job

# Prioridades (menor número = mayor prioridad)
PRIORITY_URGENT=1
PRIORITY_HIGH=3
PRIORITY_NORMAL=5
PRIORITY_LOW=10

# ========================================
# CONFIGURACIÓN DE LOGS
# ========================================
LOG_LEVEL=info                     # debug | info | warn | error
LOG_FORMAT=json                    # json | simple
LOG_DIR=logs
LOG_MAX_SIZE=10m
LOG_MAX_FILES=30
LOG_COMPRESS=true

# Logs específicos por canal
LOG_EMAIL_ENABLED=true
LOG_PUSH_ENABLED=true
LOG_SMS_ENABLED=true

# ========================================
# CONFIGURACIÓN DE API REST
# ========================================
API_PREFIX=/api/v1
API_RATE_LIMIT=1000
API_RATE_LIMIT_WINDOW=60000        # 1 minuto

# Endpoints disponibles
API_HEALTH_CHECK_ENABLED=true
API_METRICS_ENABLED=true
API_DOCS_ENABLED=true
API_DOCS_PATH=/docs

# ========================================
# CORS
# ========================================
# Solo las APIs que pueden consumir este servicio
CORS_ORIGIN=http://localhost:4000,http://localhost:5001,http://localhost:5002
CORS_METHODS=POST,GET,PUT,DELETE
CORS_CREDENTIALS=true

# ========================================
# MONITOREO Y MÉTRICAS
# ========================================
METRICS_ENABLED=true
METRICS_PORT=9090

# Métricas por canal
METRICS_EMAIL_COUNT=true
METRICS_PUSH_COUNT=true
METRICS_SMS_COUNT=true
METRICS_FAILURE_RATE=true
METRICS_PROCESSING_TIME=true

# ========================================
# CONFIGURACIÓN DE DESARROLLO
# ========================================
DEV_MODE=true
DEV_DRY_RUN=false                  # Si es true, no envía realmente las notificaciones
DEV_LOG_PAYLOAD=true               # Loguea el contenido de las notificaciones
DEV_SIMULATE_FAILURES=false        # Simula fallos aleatorios para testing
DEV_FAILURE_RATE=0.1               # 10% de fallos si SIMULATE_FAILURES=true

# Testing/Sandbox
TEST_MODE_EMAIL=true               # Usa Mailtrap o similar
TEST_MODE_SMS=true                 # No envía SMS reales
TEST_MODE_PUSH=true                # No envía push reales
TEST_RECIPIENTS_WHITELIST=         # Lista de emails/teléfonos permitidos en test